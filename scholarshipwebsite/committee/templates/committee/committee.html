{% extends 'committee/base.html'%}
{% block content %}
{% load static %}

<div class="dashboard-container">
  <div class="d-flex justify-content-between align-items-center" style="margin-bottom: 3rem;">
    <h1 class="h3 text-dark">Dashboard</h1>
  </div>

  <div class="row" style="margin-bottom: 3rem;">
    
    <div class="col" style="margin-bottom: 1rem;">
      <div class="metric-card border-info">
        <div class="metric-title text-info-custom">Total Scholarships</div>
        <div class="metric-value">{{ total_scholarships }}</div>
      </div>
    </div>

    <div class="col" style="margin-bottom: 1rem;">
      <div class="metric-card border-primary">
        <div class="metric-title text-primary-custom">Total Applications Assigned</div>
        <div class="metric-value">{{ total_apps }}</div>
      </div>
    </div>

    <div class="col" style="margin-bottom: 1rem;">
      <div class="metric-card border-success">
        <div class="metric-title text-success-custom">Approved</div>
        <div class="metric-value">{{ approved }}</div>
      </div>
    </div>
    <div class="col" style="margin-bottom: 1rem;">
      <div class="metric-card border-danger">
        <div class="metric-title text-danger-custom">Rejected</div>
        <div class="metric-value">{{ rejected }}</div>
      </div>
    </div>
    <div class="col" style="margin-bottom: 1rem;">
      <div class="metric-card border-warning">
        <div class="metric-title text-warning-custom">Pending</div>
        <div class="metric-value">{{ pending }}</div>
      </div>
    </div>
  </div>

  <div class="clearfix"></div>

  <!-- Charts Row 1 -->
  <div class="row" style="margin-bottom: 3rem;">
    <div class="col-lg-8 col-md-12">
      <div class="chart-card">
        <div class="chart-header">
          <i class="fas fa-chart-line mr-2"></i> Application Growth Trend
        </div>
        <div class="chart-body">
          <canvas id="growthChart" height="120"></canvas>
        </div>
      </div>
    </div>
    <div class="col-lg-4 col-md-12">
      <div class="chart-card">
        <div class="chart-header">
          <i class="fas fa-chart-pie mr-2"></i> Overall Status Distribution
        </div>
        <div class="chart-body">
          <canvas id="statusChart" height="200"></canvas>
        </div>
      </div>
    </div>
  </div>

  <div class="clearfix"></div>

  <!-- Charts Row 2 -->
  <div class="row">
    <div class="col-lg-6 col-md-12">
      <div class="chart-card">
        <div class="chart-header">
          <i class="fas fa-university mr-2"></i> Popularity by Scholarship
        </div>
        <div class="chart-body">
          <canvas id="scholarshipChart"></canvas>
        </div>
      </div>
    </div>
    <div class="col-lg-6 col-md-12">
      <div class="chart-card">
        <div class="chart-header">
          <i class="fas fa-user-graduate mr-2"></i> Applicant Demographics
        </div>
        <div class="chart-body">
          <canvas id="educationChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>

  <script>
    var endpoint = "{% url 'committee_api_data' %}";

    $.ajax({
      method: "GET",
      url: endpoint,
      success: function (data) {
        drawGrowthChart(data.growth_chart, 'growthChart');
        drawStatusChart(data.status_chart, 'statusChart');
        drawScholarshipChart(data.scholarship_chart, 'scholarshipChart');
        drawEducationChart(data.education_chart, 'educationChart');
      },
      error: function (error_data) {
        console.log("Error fetching chart data", error_data);
      }
    })

    // Formatting Helpers
    Chart.defaults.global.defaultFontFamily = '-apple-system,system-ui,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif';
    Chart.defaults.global.defaultFontColor = '#858796';

    function drawGrowthChart(data, id) {
      var ctx = document.getElementById(id).getContext('2d');
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: data.labels,
          datasets: [{
            label: data.label,
            data: data.data,
            borderColor: '#4e73df',
            backgroundColor: 'rgba(78, 115, 223, 0.05)',
            pointRadius: 3,
            pointBackgroundColor: '#4e73df',
            pointBorderColor: '#4e73df',
            pointHoverRadius: 3,
            pointHoverBackgroundColor: '#4e73df',
            pointHoverBorderColor: '#4e73df',
            pointHitRadius: 10,
            pointBorderWidth: 2,
            borderWidth: 2,
            fill: true
          }]
        },
        options: {
          maintainAspectRatio: true,
          layout: { padding: { left: 10, right: 25, top: 25, bottom: 0 } },
          scales: {
            yAxes: [{
              ticks: { beginAtZero: true, padding: 10 },
              gridLines: { color: "rgb(234, 236, 244)", zeroLineColor: "rgb(234, 236, 244)", drawBorder: false, borderDash: [2], zeroLineBorderDash: [2] }
            }],
            xAxes: [{
              gridLines: { display: false, drawBorder: false }
            }]
          },
          legend: { display: false },
          tooltips: {
            backgroundColor: "rgb(255,255,255)",
            bodyFontColor: "#858796",
            titleMarginBottom: 10,
            titleFontColor: '#6e707e',
            titleFontSize: 14,
            borderColor: '#dddfeb',
            borderWidth: 1,
            xPadding: 15,
            yPadding: 15,
            displayColors: false,
            intersect: false,
            mode: 'index',
            caretPadding: 10,
          }
        }
      });
    }

     function drawStatusChart(data, id) {
      var ctx = document.getElementById(id).getContext('2d');
      new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: data.labels,
          datasets: [{
            data: data.data,
            // Updated colors for 4 categories:
            // Reviewed (Blue), Rejected (Red), In-Progress (Yellow), Pending (Grey)
            backgroundColor: ['#28a745', '#e74a3b', '#f6c23e'],
            hoverBackgroundColor: ['#1f7c35', '#be2617', '#dda20a'],
            hoverBorderColor: "rgba(234, 236, 244, 1)",
          }]
        },
        options: {
          maintainAspectRatio: false,
          tooltips: {
            backgroundColor: "rgb(255,255,255)",
            bodyFontColor: "#858796",
            borderColor: '#dddfeb',
            borderWidth: 1,
            xPadding: 15,
            yPadding: 15,
            displayColors: true,
            caretPadding: 10,
          },
          legend: { display: true, position: 'bottom' },
          cutoutPercentage: 70,
        }
      });
    }

    function drawScholarshipChart(data, id) {
      var ctx = document.getElementById(id).getContext('2d');
      new Chart(ctx, {
        type: 'horizontalBar',
        data: {
          labels: data.labels,
          datasets: [{
            label: "Applications",
            data: data.data,
            backgroundColor: '#36b9cc',
            hoverBackgroundColor: '#2c9faf',
            barPercentage: 0.6,
          }]
        },
        options: {
          maintainAspectRatio: true,
          scales: {
            xAxes: [{ ticks: { beginAtZero: true }, gridLines: { display: false } }],
            yAxes: [{ gridLines: { color: "rgb(234, 236, 244)", zeroLineColor: "rgb(234, 236, 244)", drawBorder: false, borderDash: [2], zeroLineBorderDash: [2] } }]
          },
          legend: { display: false }
        }
      });
    }

    function drawEducationChart(data, id) {
      var ctx = document.getElementById(id).getContext('2d');
      var colors = ['#4e73df', '#1cc88a', '#36b9cc', '#f6c23e', '#e74a3b', '#858796'];

      new Chart(ctx, {
        type: 'pie',
        data: {
          labels: data.labels,
          datasets: [{
            data: data.data,
            backgroundColor: colors.slice(0, data.data.length),
            hoverBorderColor: "rgba(234, 236, 244, 1)",
          }]
        },
        options: {
          maintainAspectRatio: true,
          legend: { position: 'right' }
        }
      });
    }
  </script>
</div>
{% endblock %}